# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

pool:
  vmImage: 'vs2017-win2016'

steps:
- powershell: |
    [Net.ServicePointManager]::SecurityProtocol = "tls12, tls11, tls"
    iwr -outf rustup-init.exe https://win.rustup.rs
  displayName: 'Download Rust'
- script: |
    PATH=%PATH%;%USERPROFILE%\\.cargo\\bin
    rustup-init.exe -y --default-toolchain stable --default-host x86_64-pc-windows-msvc
    echo %PATH%
    rustc -vV
    cargo -vV
  displayName: 'Install Rust'
- script: |
    cd native
    cargo build --release
    cat ./target/release/build/mm2tracker-*/output
    ls -l ./target/release/mm2tracker.exe
- script: cargo test --release
